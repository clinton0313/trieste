
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>trieste.models.keras.models &#8212; trieste 0.10.0 documentation</title>
    
    <link href="../../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/styles/pydata-sphinx-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css" />
    
    <link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../../../index.html">
  <img src="../../../../../_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../../index.html">
  Trieste
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../../tutorials.html">
  Tutorials
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/secondmind-labs/trieste" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-contents">
   Module Contents
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble">
     DeepEnsemble
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.model">
       model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.ensemble_size">
       ensemble_size
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.sample_index">
       sample_index
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.prepare_dataset">
       prepare_dataset
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.prepare_query_points">
       prepare_query_points
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.predict">
       predict
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.predict_ensemble">
       predict_ensemble
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.sample">
       sample
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.sample_ensemble">
       sample_ensemble
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.trajectory_sampler">
       trajectory_sampler
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.update">
       update
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trieste.models.keras.models.DeepEnsemble.optimize">
       optimize
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="module-trieste.models.keras.models">
<span id="trieste-models-keras-models"></span><h1><a class="reference internal" href="#module-trieste.models.keras.models" title="trieste.models.keras.models"><code class="xref py py-mod docutils literal notranslate"><span class="pre">trieste.models.keras.models</span></code></a><a class="headerlink" href="#module-trieste.models.keras.models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="trieste.models.keras.models.DeepEnsemble">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">DeepEnsemble</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../architectures/index.html#trieste.models.keras.architectures.KerasEnsemble" title="trieste.models.keras.architectures.KerasEnsemble"><span class="pre">trieste.models.keras.architectures.KerasEnsemble</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../optimizer/index.html#trieste.models.optimizer.KerasOptimizer" title="trieste.models.optimizer.KerasOptimizer"><span class="pre">trieste.models.optimizer.KerasOptimizer</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bootstrap</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../interface/index.html#trieste.models.keras.interface.KerasPredictor" title="trieste.models.keras.interface.KerasPredictor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trieste.models.keras.interface.KerasPredictor</span></code></a>, <a class="reference internal" href="../../interfaces/index.html#trieste.models.interfaces.TrainableProbabilisticModel" title="trieste.models.interfaces.TrainableProbabilisticModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trieste.models.interfaces.TrainableProbabilisticModel</span></code></a>, <a class="reference internal" href="../../interfaces/index.html#trieste.models.interfaces.EnsembleModel" title="trieste.models.interfaces.EnsembleModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trieste.models.interfaces.EnsembleModel</span></code></a>, <a class="reference internal" href="../../interfaces/index.html#trieste.models.interfaces.HasTrajectorySampler" title="trieste.models.interfaces.HasTrajectorySampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trieste.models.interfaces.HasTrajectorySampler</span></code></a></p>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">TrainableProbabilisticModel</span></code> wrapper for deep ensembles built using
Keras.</p>
<p>Deep ensembles are ensembles of deep neural networks that have been found to have good
representation of uncertainty in practice (&lt;cite data-cite=”lakshminarayanan2017simple”/&gt;).
This makes them a potentially attractive model for Bayesian optimization for use-cases with
large number of observations, non-stationary objective functions and need for fast predictions,
in which standard Gaussian process models are likely to struggle. The model consists of simple
fully connected multilayer probabilistic networks as base learners, with Gaussian distribution
as a final layer, using the negative log-likelihood loss for training the networks. The
model relies on differences in random initialization of weights for generating diversity among
base learners.</p>
<p>The original formulation of the model does not include boostrapping of the data. The authors
found that it does not improve performance the model. We include bootstrapping as an option
as later work that more precisely measured uncertainty quantification found that boostrapping
does help with uncertainty representation (see &lt;cite data-cite=”osband2021epistemic”/&gt;).</p>
<p>We provide classes for constructing ensembles using Keras
(<a class="reference internal" href="../index.html#trieste.models.keras.KerasEnsemble" title="trieste.models.keras.KerasEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">KerasEnsemble</span></code></a>) in the <cite>architectures</cite> package that should be
used with the <a class="reference internal" href="../index.html#trieste.models.keras.DeepEnsemble" title="trieste.models.keras.DeepEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeepEnsemble</span></code></a> wrapper. There we also provide a
<a class="reference internal" href="../index.html#trieste.models.keras.GaussianNetwork" title="trieste.models.keras.GaussianNetwork"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussianNetwork</span></code></a> base learner following the original
formulation in &lt;cite data-cite=”lakshminarayanan2017simple”/&gt;, but any user-specified network
can be supplied, as long as it has a Gaussian distribution as a final layer and follows the
<a class="reference internal" href="../index.html#trieste.models.keras.KerasEnsembleNetwork" title="trieste.models.keras.KerasEnsembleNetwork"><code class="xref py py-class docutils literal notranslate"><span class="pre">KerasEnsembleNetwork</span></code></a> interface.</p>
<p>Note that currently we do not support setting up the model with dictionary configs and saving
the model during Bayesian optimization loop (<code class="docutils literal notranslate"><span class="pre">track_state</span></code> argument in
<a class="reference internal" href="../../../bayesian_optimizer/index.html#trieste.bayesian_optimizer.BayesianOptimizer.optimize" title="trieste.bayesian_optimizer.BayesianOptimizer.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize()</span></code></a> method should be set to <cite>False</cite>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – A Keras ensemble model with probabilistic networks as ensemble members. The
model has to be built but not compiled.</p></li>
<li><p><strong>optimizer</strong> – The optimizer wrapper with necessary specifications for compiling and
training the model. Defaults to <a class="reference internal" href="../../optimizer/index.html#trieste.models.optimizer.KerasOptimizer" title="trieste.models.optimizer.KerasOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">KerasOptimizer</span></code></a> with
<code class="xref py py-class docutils literal notranslate"><span class="pre">Adam</span></code> optimizer, negative log likelihood loss and a dictionary
of default arguments for Keras <cite>fit</cite> method: 100 epochs, batch size 100, and verbose 0.
See <a class="reference external" href="https://keras.io/api/models/model_training_apis/#fit-method">https://keras.io/api/models/model_training_apis/#fit-method</a> for a list of possible
arguments.</p></li>
<li><p><strong>bootstrap</strong> – Sample with replacement data for training each network in the ensemble.
By default set to <cite>False</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.10)"><strong>ValueError</strong></a> – If <code class="docutils literal notranslate"><span class="pre">model</span></code> is not an instance of
<a class="reference internal" href="../index.html#trieste.models.keras.KerasEnsemble" title="trieste.models.keras.KerasEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">KerasEnsemble</span></code></a> or ensemble has less than two base
learners (networks).</p>
</dd>
</dl>
<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.model">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">model</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">tensorflow.keras.Model</span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.model" title="Permalink to this definition">¶</a></dt>
<dd><p>” Returns compiled Keras ensemble model.</p>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.ensemble_size">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">ensemble_size</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.ensemble_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.ensemble_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the size of the ensemble, that is, the number of base learners or individual neural
network models in the ensemble.</p>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.sample_index">
<code class="sig-name descname"><span class="pre">sample_index</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.sample_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.sample_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a network index sampled randomly with replacement.</p>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.prepare_dataset">
<code class="sig-name descname"><span class="pre">prepare_dataset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../data/index.html#trieste.data.Dataset" title="trieste.data.Dataset"><span class="pre">trieste.data.Dataset</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.10)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.prepare_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.prepare_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform <code class="docutils literal notranslate"><span class="pre">dataset</span></code> into inputs and outputs with correct names that can be used for
training the <code class="xref py py-class docutils literal notranslate"><span class="pre">KerasEnsemble</span></code> model.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">bootstrap</span></code> argument in the <a class="reference internal" href="../index.html#trieste.models.keras.DeepEnsemble" title="trieste.models.keras.DeepEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeepEnsemble</span></code></a> is set to
<cite>True</cite>, data will be additionally sampled with replacement, independently for
each network in the ensemble.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dataset</strong> – A dataset with <code class="docutils literal notranslate"><span class="pre">query_points</span></code> and <code class="docutils literal notranslate"><span class="pre">observations</span></code> tensors.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dictionary with input data and a dictionary with output data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.prepare_query_points">
<code class="sig-name descname"><span class="pre">prepare_query_points</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.prepare_query_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.prepare_query_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform <code class="docutils literal notranslate"><span class="pre">query_points</span></code> into inputs with correct names that can be used for
predicting with the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>query_points</strong> – A tensor with <code class="docutils literal notranslate"><span class="pre">query_points</span></code>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dictionary with query_points prepared for predictions.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.predict">
<code class="sig-name descname"><span class="pre">predict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.10)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns mean and variance at <code class="docutils literal notranslate"><span class="pre">query_points</span></code> for the whole ensemble.</p>
<p>Following &lt;cite data-cite=”lakshminarayanan2017simple”/&gt; we treat the ensemble as a
uniformly-weighted Gaussian mixture model and combine the predictions as</p>
<div class="math notranslate nohighlight">
\[p(y|\mathbf{x}) = M^{-1} \Sum_{m=1}^M \mathcal{N}
(\mu_{\theta_m}(\mathbf{x}),\,\sigma_{\theta_m}^{2}(\mathbf{x}))\]</div>
<p>We further approximate the ensemble prediction as a Gaussian whose mean and variance
are respectively the mean and variance of the mixture, given by</p>
<div class="math notranslate nohighlight">
\[\mu_{*}(\mathbf{x}) = M^{-1} \Sum_{m=1}^M \mu_{\theta_m}(\mathbf{x})\]</div>
<div class="math notranslate nohighlight">
\[\sigma^2_{*}(\mathbf{x}) = M^{-1} \Sum_{m=1}^M (\sigma_{\theta_m}^{2}(\mathbf{x})
+ \mu^2_{\theta_m}(\mathbf{x})) - \mu^2_{*}(\mathbf{x})\]</div>
<p>This method assumes that the final layer in each member of the ensemble is
probabilistic, an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">¬tfp.distributions.Distribution</span></code>. In particular, given
the nature of the approximations stated above the final layer should be a Gaussian
distribution with <cite>mean</cite> and <cite>variance</cite> methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>query_points</strong> – The points at which to make predictions.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The predicted mean and variance of the observations at the specified
<code class="docutils literal notranslate"><span class="pre">query_points</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.predict_ensemble">
<code class="sig-name descname"><span class="pre">predict_ensemble</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.10)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.predict_ensemble"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.predict_ensemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns mean and variance at <code class="docutils literal notranslate"><span class="pre">query_points</span></code> for each member of the ensemble. First tensor
is the mean and second is the variance, where each has shape […, M, N, 1], where M is
the <code class="docutils literal notranslate"><span class="pre">ensemble_size</span></code>.</p>
<p>This method assumes that the final layer in each member of the ensemble is
probabilistic, an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">¬tfp.distributions.Distribution</span></code>, in particular
<cite>mean</cite> and <cite>variance</cite> methods should be available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>query_points</strong> – The points at which to make predictions.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The predicted mean and variance of the observations at the specified
<code class="docutils literal notranslate"><span class="pre">query_points</span></code> for each member of the ensemble.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.sample">
<code class="sig-name descname"><span class="pre">sample</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.sample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.sample" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> samples at <code class="docutils literal notranslate"><span class="pre">query_points</span></code>. We use the mixture approximation in
<a class="reference internal" href="#trieste.models.keras.models.DeepEnsemble.predict" title="trieste.models.keras.models.DeepEnsemble.predict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">query_points</span></code> and sample <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> times from a Gaussian
distribution given by the predicted mean and variance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_points</strong> – The points at which to sample, with shape […, N, D].</p></li>
<li><p><strong>num_samples</strong> – The number of samples at each point.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The samples. For a predictive distribution with event shape E, this has shape
[…, S, N] + E, where S is the number of samples.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.sample_ensemble">
<code class="sig-name descname"><span class="pre">sample_ensemble</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_samples</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="../../../types/index.html#trieste.types.TensorType" title="trieste.types.TensorType"><span class="pre">trieste.types.TensorType</span></a><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.sample_ensemble"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.sample_ensemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> samples at <code class="docutils literal notranslate"><span class="pre">query_points</span></code>. Each sample is taken from a Gaussian
distribution given by the predicted mean and variance of a randomly chosen network in the
ensemble. This avoids using the Gaussian mixture approximation and samples directly from
individual Gaussian distributions given by each network in the ensemble.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_points</strong> – The points at which to sample, with shape […, N, D].</p></li>
<li><p><strong>num_samples</strong> – The number of samples at each point.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The samples. For a predictive distribution with event shape E, this has shape
[…, S, N] + E, where S is the number of samples.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.trajectory_sampler">
<code class="sig-name descname"><span class="pre">trajectory_sampler</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="../../interfaces/index.html#trieste.models.interfaces.TrajectorySampler" title="trieste.models.interfaces.TrajectorySampler"><span class="pre">trieste.models.interfaces.TrajectorySampler</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#trieste.models.keras.models.DeepEnsemble" title="trieste.models.keras.models.DeepEnsemble"><span class="pre">DeepEnsemble</span></a><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.trajectory_sampler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.trajectory_sampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a trajectory sampler. For <a class="reference internal" href="#trieste.models.keras.models.DeepEnsemble" title="trieste.models.keras.models.DeepEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeepEnsemble</span></code></a>, we use an ensemble
sampler that randomly picks a network from the ensemble and uses its predicted means
for generating a trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The trajectory sampler.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.update">
<code class="sig-name descname"><span class="pre">update</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../data/index.html#trieste.data.Dataset" title="trieste.data.Dataset"><span class="pre">trieste.data.Dataset</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Neural networks are parametric models and do not need to update data.
<cite>TrainableProbabilisticModel</cite> interface, however, requires an update method, so
here we simply pass the execution.</p>
</dd></dl>

<dl class="py method">
<dt id="trieste.models.keras.models.DeepEnsemble.optimize">
<code class="sig-name descname"><span class="pre">optimize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../../../data/index.html#trieste.data.Dataset" title="trieste.data.Dataset"><span class="pre">trieste.data.Dataset</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><a class="reference internal" href="../../../../../_modules/trieste/models/keras/models.html#DeepEnsemble.optimize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trieste.models.keras.models.DeepEnsemble.optimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimize the underlying Keras ensemble model with the specified <code class="docutils literal notranslate"><span class="pre">dataset</span></code>.</p>
<p>Optimization is performed by using the Keras <cite>fit</cite> method, rather than applying the
optimizer and using the batches supplied with the optimizer wrapper. User can pass
arguments to the <cite>fit</cite> method through <code class="docutils literal notranslate"><span class="pre">minimize_args</span></code> argument in the optimizer wrapper.
These default to using 100 epochs, batch size 100, and verbose 0. See
<a class="reference external" href="https://keras.io/api/models/model_training_apis/#fit-method">https://keras.io/api/models/model_training_apis/#fit-method</a> for a list of possible
arguments.</p>
<p>Note that optimization does not return the result, instead optimization results are
stored in a history attribute of the model object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dataset</strong> – The data with which to optimize the model.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
    <script src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright Copyright 2020 The Trieste Contributors

Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>